# iOS 德州扑克游戏 - 产品功能设计文档

**文档版本**: v1.0
**编制日期**: 2026年2月
**文档状态**: 正式发布
**产品名称**: 德州扑克 (Texas Poker)
**目标平台**: iOS 15.0+
**技术栈**: SwiftUI + Combine + Core Data

---

## 一、产品概述

### 1.1 产品定位

iOS 德州扑克是一款专业级单机德州扑克游戏，应用人工智能技术打造具有独特个性的AI对手，为玩家提供接近真实牌桌的游戏体验。应用采用纯客户端架构，无需网络连接即可畅玩。

### 1.2 核心价值

| 价值主张 | 描述 |
|---------|------|
| **真实体验** | 完整的德州扑克规则实现，包括各种下注动作和牌型判定 |
| **AI 对手** | 15 种具有独特个性和行为模式的 AI 角色 |
| **数据追踪** | 全面的统计数据和历史记录，帮助玩家分析改进 |
| **多模式支持** | 现金桌和锦标赛两种经典游戏模式 |
| **离线畅玩** | 无需网络，随时随地享受扑克乐趣 |

---

## 二、已实现功能

### 2.1 游戏模式

#### 2.1.1 现金桌模式 (Cash Game)

| 功能 | 状态 | 描述 |
|-----|------|------|
| 买入系统 | ✅ 已完成 | 玩家进入时选择买入金额 |
| 补充筹码 (Top-up) | ✅ 已完成 | 玩家可随时补充到指定金额 |
| 离场结算 | ✅ 已完成 | 显示会话盈亏统计 |
| 买入限制 | ✅ 已完成 | 支持配置总买入次数限制 |
| 玩家重新入场 | ✅ 已完成 | 离场 AI 可重新买入 |

**配置参数**:
- 小盲注/大盲注: 10/20 (默认值，可配置)
- 最小买入: 400 筹码
- 最大买入: 2000 筹码
- 总买入次数限制: 5 次 (默认值，可配置)

#### 2.1.2 锦标赛模式 (Tournament)

| 功能 | 状态 | 描述 |
|-----|------|------|
| 盲注结构 | ✅ 已完成 | 自动随时间升级 |
| 前注 (Ante) | ✅ 已完成 | 锦标赛中后期加入前注 |
| 奖励圈 | ✅ 已完成 | 基于参赛人数的奖励分配 |
| 重新参赛 (Rebuy) | ✅ 已完成 | 支持比赛中期重新买入 |
| 玩家淘汰 | ✅ 已完成 | 记录淘汰顺序 |

**预设盲注结构**:
```
Level 1: 10/20 → Level 2: 15/30 → Level 3: 20/40
→ Level 4: 25/50 (加入 Ante) → Level 5: 50/100
```

### 2.2 游戏引擎

#### 2.2.1 核心规则

| 功能 | 状态 | 描述 |
|-----|------|------|
| 发牌逻辑 | ✅ 已完成 | 翻牌前、翻牌、转牌、河牌 |
| 下注系统 | ✅ 已完成 | Check/Call/Raise/Fold/All-in |
| 池分配 | ✅ 已完成 | 主池和边池计算 |
| 摊牌判定 | ✅ 已完成 | 牌型比较和赢家判定 |
| 牌型识别 | ✅ 已完成 | 从高牌到皇家同花顺 |
| 公共牌不足处理 | ✅ 已完成 | 翻牌前全下时的牌型判定 |

#### 2.2.2 游戏状态机

```
idle → dealing → waitingForAction → betting → showdown → (循环)
```

### 2.3 AI 对手系统

#### 2.3.1 AI 角色库 (15个角色)

| # | 角色名称 | 头像 | 游戏风格 | 难度 | 特征 |
|---|---------|------|---------|------|------|
| 1 | 石头 | 🪨 | 紧凶型 | ⭐⭐⭐ | 只玩优质手牌，从不诈唬 |
| 2 | 疯子麦克 | 🤪 | 松凶型 | ⭐ | 持续加注，几乎不弃牌 |
| 3 | 安娜 | 👩 | 松弱型 | ⭐ | 喜欢跟注，从不加注 |
| 4 | 老狐狸 | 🦊 | 平衡型 | ⭐⭐ | 难以捉摸，策略性强 |
| 5 | 鲨鱼汤姆 | 🦈 | 位置型 | ⭐⭐⭐ | 利用位置，收割松鱼 |
| 6 | 艾米 | 🎓 | GTO型 | ⭐⭐⭐ | 数学驱动，最优策略 |
| 7 | 大卫 | 😤 | 情绪型 | ⭐⭐ | 情绪化，可能上头 |
| 8 | 新手鲍勃 | 🐟 | 鱼 | ⭐ | 什么牌都跟 |
| 9 | 玛丽 | 🐢 | 紧弱型 | ⭐ | 只跟注不加注 |
| 10 | 史蒂夫 | 🥶 | 超紧型 | ⭐⭐⭐⭐ | 只玩 AA/KK |
| 11 | 杰克 | 🎭 | 诈骗型 | ⭐⭐⭐ | 诈唬狂魔 |
| 12 | 山姆 | 💰 | 短码型 | ⭐⭐⭐⭐ | 要么全下要么弃牌 |
| 13 | 托尼 | 🕸️ | 陷阱型 | ⭐⭐⭐ | 喜欢慢打大牌 |
| 14 | 皮特 | 🧠 | 适应型 | ⭐⭐⭐⭐⭐ | 学习能力强 |
| 15 | 维克多 | 🎖️ | 抓鱼型 | ⭐⭐⭐⭐⭐ | 专门抓松鱼 |

#### 2.3.2 AI 决策系统

| 功能 | 状态 | 描述 |
|-----|------|------|
| 蒙特卡洛模拟 | ✅ 已完成 | 计算胜率 (100-1000 次迭代) |
| 底池赔率计算 | ✅ 已完成 | 判断跟注是否划算 |
| 位置意识 | ✅ 已完成 | 根据座位位置调整策略 |
| 个性化调整 | ✅ 已完成 | 基于角色参数的决策偏移 |
| 诈唬逻辑 | ✅ 已完成 | 基于牌力和底池大小的诈唬 |
| ICM 策略 | ✅ 已完成 | 锦标赛后期考虑淘汰风险 |

#### 2.3.3 AI 难度等级

| 难度  | 可选角色          | 目标用户 |
| --- | ------------- | ---- |
| 简单  | 鲍勃、玛丽、安娜、疯子麦克 | 新手练习 |
| 普通  | + 石头、老狐狸、大卫   | 标准体验 |
| 困难  | + 汤姆、杰克、托尼、山姆 | 有挑战性 |
| 专家  | 皮特、维克多、史蒂夫、山姆 | 高手挑战 |

### 2.4 数据统计系统

#### 2.4.1 玩家统计

| 指标 | 状态 | 描述 |
|-----|------|------|
| VPIP (主动入池率) | ✅ 已完成 | 自愿投入筹码的比例 |
| PFR (翻前加注率) | ✅ 已完成 | 翻前加注的比例 |
| AF (攻击性) | ✅ 已完成 | 下注/加注 vs 跟注的比值 |
| 胜率统计 | ✅ 已完成 | 按位置、手牌类型统计 |
| 盈亏追踪 | ✅ 已完成 | 现金桌累计盈亏 |
| 历史对局 | ✅ 已完成 | 完整对局记录 |

#### 2.4.2 AI 资金管理

| 功能 | 状态 | 描述 |
|-----|------|------|
| AI 银行系统 | ✅ 已完成 | 追踪每个 AI 的资金 |
| 盈利/亏损记录 | ✅ 已完成 | 记录 AI 每手牌的盈亏 |
| 重购逻辑 | ✅ 已完成 | 根据 bankroll 决定是否重新入场 |

### 2.5 用户界面

#### 2.5.1 主界面

| 组件 | 状态 | 描述 |
|-----|------|------|
| 牌桌视图 | ✅ 已完成 | 8 人椭圆形牌桌布局 |
| 玩家信息 | ✅ 已完成 | 显示头像、名称、筹码 |
| 公共牌 | ✅ 已完成 | 翻牌动画效果 |
| 底池显示 | ✅ 已完成 | 显示当前底池金额 |
| 操作按钮 | ✅ 已完成 | Check/Call/Raise/Fold/All-in |
| 加注滑块 | ✅ 已完成 | 滑动选择加注金额 |

#### 2.5.2 游戏信息

| 组件 | 状态 | 描述 |
|-----|------|------|
| 行动日志 | ✅ 已完成 | 显示每手牌的动作记录 |
| 锦标赛信息 | ✅ 已完成 | 显示盲注级别、剩余玩家 |
| 现金桌信息 | ✅ 已完成 | 显示买入次数限制 |
| 玩家排名 | ✅ 已完成 | 锦标赛实时排名 |
| 统计数据面板 | ✅ 已完成 | VPIP/PFR 等数据 |

#### 2.5.3 设置与配置

| 功能 | 状态 | 描述 |
|-----|------|------|
| 游戏模式选择 | ✅ 已完成 | 现金桌/锦标赛 |
| AI 对手选择 | ✅ 已完成 | 自定义参与对手 |
| 盲注配置 | ✅ 已完成 | 自定义盲注结构 |
| 买入配置 | ✅ 已完成 | 设置买入限制 |
| 音效开关 | ✅ 已完成 | 开启/关闭音效 |
| 深色模式 | ✅ 已完成 | 自动适配系统主题 |

### 2.6 玩家档案系统

| 功能 | 状态 | 描述 |
|-----|------|------|
| 多档案支持 | ✅ 已完成 | 创建多个游戏档案 |
| 独立统计 | ✅ 已完成 | 每个档案独立统计 |
| 独立设置 | ✅ 已完成 | 每个档案独立设置 |
| 档案切换 | ✅ 已完成 | 快速切换游戏档案 |

---

## 三、功能待办

### 3.1 游戏增强

| 功能   | 优先级 | 描述         |
| ---- | --- | ---------- |
| 多人游戏 | P0  | 支持多玩家同时游戏  |
| 私人房间 | P1  | 创建私人房间邀请好友 |
| 教学指导 | P2  | 新手教程和提示    |
| 成就系统 | P2  | 解锁成就增加趣味性  |

### 3.2 AI 增强

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| AI 学习系统 | P1 | AI 根据玩家风格自适应 |
| 对手建模 | P1 | 记录玩家风格并针对性策略 |
| 情绪模拟 | P2 | 更真实的 AI 情绪表现 |

### 3.3 社交功能

| 功能 | 优先级 | 描述 |
|-----|-------|------|
| 排行榜 | P1 | 全球/好友排名 |
| 战绩分享 | P2 | 分享精彩对局到社交媒体 |
| 皮肤系统 | P2 | 牌桌、扑克牌皮肤 |

### 3.4 数据分析

| 功能      | 优先级 | 描述       |
| ------- | --- | -------- |
| 手牌回顾    | P1  | 回放历史对局   |
| leak 检测 | P2  | 分析玩家技术漏洞 |
| GTO 推荐  | P2  | 推荐最优打法   |

---

## 四、技术架构

### 4.1 架构模式

```
┌─────────────────────────────────────────────────────────┐
│                     View Layer (SwiftUI)                │
├─────────────────────────────────────────────────────────┤
│                  ViewModel (ObservableObject)            │
├─────────────────────────────────────────────────────────┤
│                State Machine (PokerGameStore)           │
├─────────────────────────────────────────────────────────┤
│                   Engine Layer (PokerEngine)            │
│  ├── BettingManager    ├── HandEvaluator               │
│  ├── DealingManager    ├── ShowdownManager             │
│  ├── CashGameManager  ├── TournamentManager           │
├─────────────────────────────────────────────────────────┤
│                     AI Layer (DecisionEngine)           │
│  ├── MonteCarloSimulator  ├── ICMCalculator          │
│  ├── OpponentModeler     ├── BluffDetector            │
├─────────────────────────────────────────────────────────┤
│                  Data Layer (Core Data)                 │
│  ├── ProfileManager    ├── StatisticsCalculator       │
│  └── PersistenceController                            │
└─────────────────────────────────────────────────────────┘
```

### 4.2 核心模块说明

| 模块 | 职责 |
|------|------|
| **PokerEngine** | 主游戏循环，管理发牌、状态流转 |
| **BettingManager** | 处理所有下注逻辑 |
| **HandEvaluator** | 评估牌型强度 |
| **ShowdownManager** | 判定胜负、分配底池 |
| **DecisionEngine** | AI 决策核心 |
| **CashGameManager** | 现金桌买入/离场逻辑 |
| **TournamentManager** | 锦标赛盲注升级逻辑 |
| **ProfileManager** | 玩家档案管理 |
| **StatisticsCalculator** | 统计数据计算 |

### 4.3 数据持久化

| 存储方式 | 用途 |
|---------|------|
| Core Data | 游戏记录、统计数据、对手建模数据 |
| UserDefaults | 游戏设置、当前档案、简单配置 |
| JSON 编码 | 会话数据、导出的统计 |

---

## 五、版本历史

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2026-02 | 初始版本发布，包含现金桌和锦标赛模式，15个AI角色 |

---

## 六、附录

### 6.1 文件结构

```
TexasPoker/
├── App/                    # 应用入口
├── Core/
│   ├── AI/                 # AI 决策系统
│   ├── Data/               # 数据持久化
│   ├── Engine/             # 游戏引擎
│   ├── FSM/                # 状态机
│   ├── Models/             # 数据模型
│   └── Utils/              # 工具类
├── UI/
│   ├── Components/         # UI 组件
│   └── Views/              # 视图
├── Resources/              # 资源文件
└── TexasPokerTests/        # 单元测试
```

### 6.2 构建命令

```bash
# Debug 构建
xcodebuild -project TexasPoker.xcodeproj \
           -scheme TexasPoker \
           -destination 'platform=iOS Simulator,name=iPhone 17' \
           -configuration Debug build

# Release 构建
xcodebuild -project TexasPoker.xcodeproj \
           -scheme TexasPoker \
           -destination 'platform=iOS Simulator,name=iPhone 17' \
           -configuration Release build

# 运行测试
xcodebuild test -project TexasPoker.xcodeproj \
                -scheme TexasPoker \
                -destination 'platform=iOS Simulator,name=iPhone 17'
```

---

**文档编制**: AI 产品团队
**审核状态**: 已审核
**保密级别**: 公开
